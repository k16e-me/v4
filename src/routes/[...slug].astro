---
import { getCollection } from 'astro:content'
import { collections } from '@content/config'
import Base from '@layouts/Base.astro'
import Work from '@composites/Work.astro'
import Backbar from '@layouts/Backbar.astro'
import pathworx from '@scripts/pathworx'
import Child from '@layouts/Child.astro'

export async function getStaticPaths() {
	const
        pages = await getCollection('pages'),
		work = await getCollection('work'),
		blog = await getCollection('blog'),
		allCollections = [...pages, ...work, ...blog]

	return allCollections.map((entry) => ({
		params: { slug: slug(entry) },
		props: { entry },
	}))

	function slug(entry) {
		if (entry.collection === 'pages')
			return entry.slug === 'home' ? undefined : entry.slug
		else return `${entry.collection}/${entry.slug}`
	}
}

const
    { entry } = Astro.props,
	{ Content } = await entry.render(),
	{
		pathname,
		isCollection,
		isCollectionChild,
		collection,
		collectionParent,
	} = pathworx(Astro.url)
---

<Base frontmatter={entry}>
	{(isCollection() || isCollectionChild()) && <Backbar />}
	{
		isCollectionChild() ? (
			<Child Content={Content} entry={entry} />
		) : (
			<Content />
		)
	}
</Base>
